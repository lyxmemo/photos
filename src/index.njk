---
layout: base.njk
---

<div x-data="photoGallery('{{ '/search-index.json' | url }}')" x-init="init()" @keydown.window="handleKeydown($event)">
    <div class="p-4 bg-white shadow-md rounded-lg mb-4">
        <input type="text" x-model="searchQuery" @input.debounce.300ms="filterPhotos()" placeholder="Search photos..." class="w-full p-2 border rounded">
        <div class="mt-4">
            <template x-for="tag in uniqueTags" :key="tag">
                <button @click="toggleTag(tag)" :class="{'bg-blue-500 text-white': selectedTags.includes(tag), 'bg-gray-200': !selectedTags.includes(tag)}" class="px-3 py-1 rounded-full text-sm mr-2 mb-2">
                    <span x-text="tag"></span>
                </button>
            </template>
        </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <template x-for="photo in filteredPhotos" :key="photo.url">
            <div class="bg-white rounded-lg shadow-md overflow-hidden cursor-pointer transition-transform hover:scale-105" @click="expandPhoto(photo)">
                <img :src="photo.imageUrl" :alt="photo.name" class="w-full h-48 object-cover">
                <div class="p-4">
                    <div class="mt-2">
                        <template x-for="tag in photo.tags" :key="tag">
                            <span class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2" x-text="tag"></span>
                        </template>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Modal for expanded photo -->
    <div x-show="showModal" 
         x-transition:enter="transition ease-out duration-300" 
         x-transition:enter-start="opacity-0" 
         x-transition:enter-end="opacity-100" 
         x-transition:leave="transition ease-in duration-200" 
         x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50"
         @click="handleModalClick($event)"
         style="display: none;">
        
        <div class="relative max-w-7xl max-h-full p-4">
            <!-- Close button -->
            <button @click="closeModal()" 
                    class="absolute top-2 right-2 text-white hover:text-gray-300 text-3xl z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center">
                Ã—
            </button>
            
            <!-- Expanded image -->
            <template x-if="expandedPhoto">
                <div class="flex flex-col items-center">
                    <img :src="expandedPhoto.imageUrl" 
                         :alt="expandedPhoto.name" 
                         class="max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl">
                    
                    <!-- Photo info -->
                    <div class="mt-4 text-center text-white">
                        <h2 class="text-xl font-bold mb-2" x-text="expandedPhoto.name"></h2>
                        <template x-if="expandedPhoto.location">
                            <p class="text-gray-300 mb-2" x-text="expandedPhoto.location"></p>
                        </template>
                        <div class="flex flex-wrap justify-center gap-2">
                            <template x-for="tag in expandedPhoto.tags" :key="tag">
                                <span class="inline-block bg-white bg-opacity-20 rounded-full px-3 py-1 text-sm text-white" x-text="tag"></span>
                            </template>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>
